<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Managing Agents &mdash; OSSEC</title>
    
    <link rel="stylesheet" href="../../../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/bootstrap-3.2.0/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/bootstrap-3.2.0/css/bootstrap-theme.min.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/parallax.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '2.8.2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../../../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../../../_static/bootstrap-3.2.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../../../_static/bootstrap-sphinx.js"></script>
    <link rel="author" title="About these documents" href="../../../about.html" />
    <link rel="top" title="OSSEC" href="../../../index.html" />
  
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  
  
  <link href="http://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.min.css" rel="stylesheet">
  
  <style type="text/css">
    ul.ablog-archive {list-style: none; overflow: auto; margin-left: 0px}
    ul.ablog-archive li {float: left; margin-right: 5px; font-size: 80%}
  </style>

  </head>
  <body role="document">

  <div id="navbar" class="navbar navbar-inverse navbar-default ">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../../../index.html"><img src="../../../_static/ossec_logo_bare_small.png">
          OSSEC</a>
        <span class="navbar-text navbar-version pull-left"><b></b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="../../../about.html">About <i class="fa fa-info-circle"></i></a></li>
                <li><a href="../../../blog.html">Blog <i class="fa fa-archive"></i></a></li>
                <li><a href="../../">Documentaton <i class="fa fa-book"></i></a></li>
                <li><a href="../../../downloads.html">Downloads <i class="fa fa-download"></i></a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../../../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"></ul>
</li>
              
            
            
              
                
              
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12">
      
  <div class="section" id="managing-agents">
<span id="manual-agent-manage"></span><h1>Managing Agents<a class="headerlink" href="#managing-agents" title="Permalink to this headline">¶</a></h1>
<p>To add an agent to an OSSEC manager with <a class="reference internal" href="../../programs/manage_agents.html#manage-agents"><span>manage_agents</span></a> you need to follow the steps below.</p>
<ol class="arabic simple">
<li>Run manage_agents on the OSSEC server.</li>
<li>Add an agent.</li>
<li>Extract the key for the agent.</li>
<li>Copy that key to the agent.</li>
<li>Run manage_agents on the agent.</li>
<li>Import the key copied from the manager.</li>
<li>Restart the manager&#8217;s OSSEC processes.</li>
<li>Start the agent.</li>
</ol>
<div class="section" id="manage-agents-on-the-ossec-server">
<h2>manage_agents on the OSSEC server<a class="headerlink" href="#manage-agents-on-the-ossec-server" title="Permalink to this headline">¶</a></h2>
<p>The server version of manage_agents provides an interface to:</p>
<ul class="simple">
<li>add an OSSEC agent to the OSSEC server</li>
<li>extract the key for an agent already added to the OSSEC server</li>
<li>remove an agent from the OSSEC server</li>
<li>list all agents already added to the OSSEC server.</li>
</ul>
<div class="section" id="running-manage-agents-and-start-screen">
<h3>Running manage_agents and start screen<a class="headerlink" href="#running-manage-agents-and-start-screen" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal"><span class="pre">manage_agents</span></code> should be run as a user with
the appropriate privileges (e.g. root).</p>
<p>Run <code class="docutils literal"><span class="pre">manage_agents</span></code>:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="gp">#</span> /var/ossec/bin/manage_agents
</pre></div>
</div>
<p>The manage_agents menu:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">****************************************</span>
<span class="go">* OSSEC HIDS v2.5-SNP-100809 Agent manager.     *</span>
<span class="go">* The following options are available: *</span>
<span class="go">****************************************</span>
<span class="go">   (A)dd an agent (A).</span>
<span class="go">   (E)xtract key for an agent (E).</span>
<span class="go">   (L)ist already added agents (L).</span>
<span class="go">   (R)emove an agent (R).</span>
<span class="go">   (Q)uit.</span>
<span class="go">Choose your action: A,E,L,R or Q:</span>
</pre></div>
</div>
<p>Typing the appropriate letter and hitting enter will initiate that function.</p>
</div>
<div class="section" id="adding-an-agent">
<h3>Adding an agent<a class="headerlink" href="#adding-an-agent" title="Permalink to this headline">¶</a></h3>
<p>To add an agent type <code class="docutils literal"><span class="pre">a</span></code> in the start screen:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">Choose your action: A,E,L,R or Q: a</span>
</pre></div>
</div>
<p>You are then prompted to provide a name for the new agent.
This can be the hostname or another string to identify the system.
In this example the agent name will be agent1.</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">- Adding a new agent (use &#39;\q&#39; to return to the main menu).</span>
<span class="go">  Please provide the following:</span>
<span class="go">   * A name for the new agent: agent1</span>
</pre></div>
</div>
<p>After that you have to specify the IP address for the agent. This can either be a single
IP address (e.g. 192.168.1.25), a range of IPs (e.g. 192.168.2.0/24), or <code class="docutils literal"><span class="pre">any</span></code>. Using a
network range or <code class="docutils literal"><span class="pre">any</span></code> is preferable when the IP of the agent may change frequently
(DHCP), or multiple systems will appear to come from the same IP address (NAT).</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">* The IP Address of the new agent: 192.168.2.0/24</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">If you use a specific IP address it <strong>must</strong> be unique. Duplicate IP addresses will cause issues.
Multiple systems can use the same IP range or <code class="docutils literal"><span class="pre">any</span></code>.</p>
</div>
<p>The last information you will be asked for is the ID you want to assign to the agent.
<a class="reference internal" href="../../programs/manage_agents.html#manage-agents"><span>manage_agents</span></a> will suggest a value for the ID. This value should be the lowest positive
number that is not already assigned to another agent. The ID 000 is assigned to the
OSSEC server. To accept the suggestion, simply press ENTER. To choose another value,
type it in and press ENTER.</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">* An ID for the new agent[001]:</span>
</pre></div>
</div>
<p>As the final step in creating an agent, you have to confirm adding the agent:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">Agent information:</span>
<span class="go">   ID:002</span>
<span class="go">   Name:agent1</span>
<span class="go">   IP Address:192.168.2.0/24</span>

<span class="go">Confirm adding it?(y/n): y</span>
<span class="go">Agent added.</span>
</pre></div>
</div>
<p>After that <a class="reference internal" href="../../programs/manage_agents.html#manage-agents"><span>manage_agents</span></a> appends the agent information to /var/ossec/etc/client.keys
and goes back to the start screen.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">If this is the first agent added to this server, the server&#8217;s OSSEC processes should be restarted using <code class="docutils literal"><span class="pre">/var/ossec/bin/ossec-control</span> <span class="pre">restart</span></code>.</p>
</div>
</div>
</div>
<div class="section" id="extracting-the-key-for-an-agent">
<h2>Extracting the key for an agent<a class="headerlink" href="#extracting-the-key-for-an-agent" title="Permalink to this headline">¶</a></h2>
<p>After adding an agent, a key is created. This key must be copied to the agent.
To extract the key, use the <code class="docutils literal"><span class="pre">e</span></code> option in the manage_agents start screen. You will be
given a list of all agents on the server. To extract the key for an agent,
simply type in the agent ID. It is important to note that you have
to enter all digits of the ID.</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">Choose your action: A,E,L,R or Q: e</span>

<span class="go">Available agents:</span>
<span class="go">   ID: 001, Name: agent1, IP: 192.168.2.0/24</span>
<span class="go">Provide the ID of the agent to extract the key (or &#39;\q&#39; to quit): 001</span>

<span class="go">Agent key information for &#39;001&#39; is:</span>
<span class="go">MDAyIGFnZW50MSAxOTIuMTY4LjIuMC8yNCBlNmY3N2RiMTdmMTJjZGRmZjg5YzA4ZDk5m</span>

<span class="go">** Press ENTER to return to the main menu.</span>
</pre></div>
</div>
<p>The key is encoded in the string (shortened for this example)
<code class="docutils literal"><span class="pre">MDAyIGFnZW50MSAxOTIuMTY4LjIuMC8yNCBlNmY3N2RiMTdmMTJjZGRmZjg5YzA4ZDk5Mm</span></code>
and includes information about the agent. This string can be added to the agent through the agent version of
<code class="docutils literal"><span class="pre">manage_agents</span></code>.</p>
</div>
<div class="section" id="removing-an-agent">
<h2>Removing an agent<a class="headerlink" href="#removing-an-agent" title="Permalink to this headline">¶</a></h2>
<p>If you want to remove an OSSEC agent from the server, use the <code class="docutils literal"><span class="pre">r</span></code> option in the <a class="reference internal" href="../../programs/manage_agents.html#manage-agents"><span>manage_agents</span></a>
start screen. You will be given a list of all agents already added to the server. To remove
an agent, simply type in the ID of the agent, press enter, and finally confirm the deletion.
It is important to note that you have to enter all digits of the ID.</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">Choose your action: A,E,L,R or Q: r</span>

<span class="go">Available agents:</span>
<span class="go">   ID: 001, Name: agent1, IP: 192.168.2.0/24</span>
<span class="go">Provide the ID of the agent to be removed (or &#39;\q&#39; to quit): 001</span>
<span class="go">Confirm deleting it?(y/n): y</span>
<span class="go">Agent &#39;001&#39; removed.</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">manage_agents</span></code> then invalidates the agent information in
<code class="docutils literal"><span class="pre">/var/ossec/etc/client.keys</span></code>. Only the values for ID and the key are kept to
avoid conflicts when adding agents. The deleted agent can no longer
communicate with the OSSEC server.</p>
</div>
<div class="section" id="manage-agents-on-ossec-agents">
<h2>manage_agents on OSSEC agents<a class="headerlink" href="#manage-agents-on-ossec-agents" title="Permalink to this headline">¶</a></h2>
<p>The agent version provides an interface for importing authentication keys.</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">****************************************</span>
<span class="go">* OSSEC HIDS v2.5-SNP-100809 Agent manager.     *</span>
<span class="go">* The following options are available: *</span>
<span class="go">****************************************</span>
<span class="go">   (I)mport key from the server (I).</span>
<span class="go">   (Q)uit.</span>
<span class="go">Choose your action: I or Q: i</span>

<span class="go">* Provide the Key generated by the server.</span>
<span class="go">* The best approach is to cut and paste it.</span>
<span class="go">*** OBS: Do not include spaces or new lines.</span>

<span class="go">Paste it here (or &#39;\q&#39; to quit): [key extracted via manage_agents on the server]</span>

<span class="go">Agent information:</span>
<span class="go">   ID:001</span>
<span class="go">   Name:agent1</span>
<span class="go">   IP Address:192.168.2.0/24</span>

<span class="go">Confirm adding it?(y/n): y</span>
<span class="go">Added.</span>
<span class="go">** Press ENTER to return to the main menu.</span>
</pre></div>
</div>
<p>For the changes to be in effect you have to
restart the server and start the agent.</p>
</div>
</div>

  <div class="section">
  
  
  </div>

    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2010-2015, OSSEC Project Team - OSSEC trademark and domain owned by Trend Micro, Inc. - Home page images courtesy of Pixbay.com.<br/>
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.3.1.<br/>
    </p>
  </div>
</footer>
  </body>
</html>